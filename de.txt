1

Automatic Zoom
1) Mantıksal İlişki 
• OCPP: Şarj istasyonu (Charge Point, CP) ile merkezi yönetim (CSMS) arasındaki ağ protokolü. 
• CAN-bus: CP içindeki kontrol birimleri (power electronics, metering, relay kontrol, kullanıcı arayüzü) 
veya araç içindeki ECU’lar arasındaki lokal haberleşme protokolü. 
• Köprü: Bir saldırgan OCPP kanalını ele geçirirse (ör. zayıf şifreleme / MitM), CP üzerindeki yazılımı 
manipüle ederek CAN üzerinden yerel kontrol mesajları gönderebilir veya değiştirebilir. Bu yüzden 
OCPP zafiyetleri fiziksel işlem/cihaz kontrolü (ör. şarjı kesme/başlatma, güç parametrelerini değiştirme, 
ölçüm manipülasyonu) ile sonuçlanabilir. 
 
2) Tehdit modeli — hangi saldırılar mümkün? 
• Uzaktan komut taklidi: CSMS’ye sahte RemoteStartTransaction/RemoteStopTransaction gönderilip CP 
bu komutu CAN aracılığıyla gerçek röle/şarj kontrol modülüne iletebilir. 
• Mesaj değiştirme / MitM: Zayıf TLS/WS ile trafiği yakalayıp OCPP mesajlarını değiştirerek CP’ye hatalı 
parametreler gönderme. 
• Firmware/konfig enjeksiyonu: Zayıf kimlik doğrulama varsa CP’ye zararlı firmware gönderilip CAN 
seviyesinde davranış değiştirilir. 
• CAN enjeksiyonu: CP’nin yazılımı ele geçirilmişse CP içinden CAN üzerinde sahte/ani frame’ler 
üretilerek bağlı cihazları karıştırma. 
• Sensör/veri manipülasyonu: MeterValues vs enerji ölçümlerini değiştirme → faturalama hilesi. 
 
3) Hangi bileşenler “köprü” görevinde? 
• CP main controller (MCU/SoC) — OCPP agent burada çalışır ve CAN transceiver ile arabirim kurar. 
• Gateway bileşeni: OCPP → application logic → CAN frame mapping. (Örn: RemoteStopTransaction → 
CAN ID 0x101, payload: {conn_id, stop_flag}). 
• HSM/secure element (yoksa risk artar). 
 
4) Uygulama 
Uygulama üç aşamada yürütülebilir: (A) altyapı hazırlık, (B) OCPP senaryosu + CAN simülasyonu, (C) saldırı ve 
savunma. 
 
A) Altyapı — yazılım & basit donanım 
• GEREKLİ (yazılım): 
o Linux (öğrencilerin laptopları ya da VM). 
o python3, pip, virtualenv. 
o Python kütüphaneleri: ocpp, websockets, aiohttp, python-can, cantools (opsiyonel). 
• GEREKLİ (donanım / alternatifler): 
o Sanal CAN (vcan0) — donanım gerektirmez (önerilir, güvenli). 
o (Opsiyonel) USB-CAN adaptör (Peak, Kvaser, Lawicel/PCAN) veya Raspberry Pi + CAN HAT — 
gerçek bus deneyleri için. 
 
B) Basit mapping: OCPP action → CAN frame (örnek) 
• Tanımlayın (eğitim amaçlı, rastgele/örnek ID’ler): 
o RemoteStartTransaction → CAN ID 0x200, payload [cp_id, connector_id, start_cmd] 
o RemoteStopTransaction → CAN ID 0x201, payload [tx_id, stop_cmd] 
o SetChargingProfile → CAN ID 0x210, payload [profile_id, max_current] 
o MeterValues (CP → CSMS) → CAN ID 0x300 (meter module → cp agent) 
• Not: Gerçek araç/şarj ekipmanlarının ID’leri farklıdır. 
 
C) Uygulama — örnek akış 
1. Başlat (CSMS + CP simülatörleri çalışsın). CP simülatörü OCPP ile CSMS’e bağlanır ve aynı 
zamanda python-can ile vcan0 üzerinde “charger control” mesajlarını dinler / yayınlar. 
2. Normal akış: CSMS RemoteStartTransaction gönderir → CP agent bu OCPP mesajını parse edip uygun 
CAN frame’i (0x200) vcan0 üzerine gönderir → charger modülü (simüle edilmiş) buna yanıt verir 
(0x300 meter). Öğrenciler tüm akışı loglar. 
3. Saldırı simülasyonu (zayıf şifreleme): Farklı senaryolar: 
o A: Plain ws kullanırken mitm proxy ile OCPP mesajını 
yakalayıp RemoteStopTransaction’ı start yerine stop yapın; CP bunu CAN’e iletir → şarj kesilir 
(simülasyon). 
o B: WSS zayıf halinde (test/self-signed), öğretmen tarafından “sahte sertifika” sunularak / 
simule edilerek MitM benzetimi. 
o C: Firmware değişikliği benzetimi: CP yazılımı içinde “if compromised: send extra CAN frame 
id 0x9FF” simüle edilir. Bu frame, charger modülünde hatalı davranışa yol açar (ör. röle sürekli 
açık). 
 
5) Öğrenci aktiviteleri / görevler (ölçeklenebilir) 
• Temel: vcan0 kur, basit CAN send/recv script’i yaz, OCPP BootNotification’i yakala ve mapping yap. 
• Orta: Plain ws senaryosu ile MitM (proxy) kullanarak OCPP mesajını değiştir; CP’nin CAN çıktısını izle; 
rapor yaz. 
• İleri: Anomaly detection: CAN trafiği için basit istatistiksel IDS yaz (ör. ID frekans histogramı, 
beklenmeyen ID tespit). Savunma: gateway filtre/allowlist uygula; mutual TLS ile OCPP koruması sağla 
ve farkı göster. 
 
6) Savunma & iyileştirme (öğretilebilir konular) 
• Gateway bedeli (filtering): OCPP’den gelen komutların yalnızca izinli CAN ID/payload formatına 
dönüştürülmesi (whitelisting). 
• Firmware imzalama & secure boot: CP’de yalnızca imzalı firmware çalıştırma. 
• Mutual TLS ve güçlü anahtar yönetimi: OCPP kanalının korunması. 
• CAN segragasyonu: Kritik CAN segmentlerini yalnızca güvenilir donanımla bağlamak; yönetim trafiğini 
ayrı tutmak. 
• CAN-IDS: Zaman-seri analiz, frekans, entropy gibi metriklerle anomali algılama. 
• Uçta doğrulama: CAN uygulama katmanında mesaj düzeyinde MAC/HMAC eklenmesi (uygulama-
katman güvenliği). 
 
7) Güvenlik ve etiklik notu (zorunlu) 
• Tüm çalışmalar izole ağda, izinli ve yalnızca simüle edilmiş cihazlarla yapılmalı. Gerçek araçlar/servis 
sağlayıcı altyapılarına yönelik testler için mutlaka yazılı izin gereklidir. 
• Öğrencilere etik kurallar (sorumluluk, paylaşım kısıtları, logların anonimleşmesi) önceden açıkça 
iletilmeli. 
 
8) Örnek SMART hedefler (öğrenci grubu için) 
• S: “Bir sonraki 2 ders içinde CSMS → CP → vcan0 akışını çalışır hale getireceğiz ve BootNotification ile 
MeterValues akışını loglayacağız.” 
• M: “MitM ile en az iki farklı OCPP mesajının (BootNotification, RemoteStop) içerik değişikliğini 
gösterip, CP tarafından üretilen ilgili CAN frame’leri yakalayacağız.” 
• A: “Her grup en fazla 3 kişiden oluşacak ve sağlanan örnek kodu adaptasyonla çalıştıracak.” 
• R: “Tüm senaryolar vcan0 üzerinde simüle edilecek; gerçek donanım gerekmez.” 
• T: “2 hafta (4 ders) içinde görev tamamlanacak; 3. haftanın sonuna kadar rapor sunulacak.” 
 
9) Değerlendirme kriterleri (öneri) 
• Teknik başarı (3): Sistemi uçtan uca çalıştırma ve log sunma. 
• Güvenlik farkındalığı (3): Saldırı/savunma farkının doğru analiz edilmesi. 
• Rapor & sunum (2): Sonuçların açık, kısa ve teknik doğrulukta raporlanması. 
• Yenilik/ek (2): Basit CAN-IDS veya gateway white-list uygulaması ekleyen gruba bonus. 
 
10) İleri kaynaklar / araçlar (özet) 
• python-can, cantools, can-utils (Linux). 
• vcan (sanal CAN). 
• USB-CAN adaptörler (PEAK/PCAN, Kvaser) — gerçek hardware isteyen projeler için. 
• ocpp Python kütüphanesi (CP/CSMS simülasyonu). 
• Basit WebSocket proxy / mitmproxy (izinli, lokal). 
 